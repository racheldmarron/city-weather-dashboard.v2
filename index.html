<!doctype html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>City Weather Dashboard</title>
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
       <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
       <link rel="stylesheet" href="./assets/style.css">
    </head>
<body>
    <div class="container">
        <div class="row">
            <h1 class="card-panel teal lighten-2">City Weather Dashboard</h1>
        </div>
        <div class="row">
            <div class="input-field col s6">
              <input value="Denver" id="cityName" type="text" class="validate">
              <label class="active" for="first_name2">City Name</label>
            </div>
            <a id="searchBtn" class="waves-effect waves-light btn"><i class="material-icons right">search</i>Search</a>
          </div>
          <div class="searchedCities"></div>
          <div class="row">
             <p>Current Forecast:</p>
              <div id="currentDiv"></div>
          </div>
          <div class="row">
              <p>Five Day Forecast:</p>
              <div id="fiveDay" class="fiveDayColor"></div>
          </div>
    </div>

</body>














  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
let myStoredCities = JSON.parse(localStorage.getItem('storedCities')) || []

// for(i = 0; i < myStoredCities.length; i++) {
//     $("#searchedCities").append("<a href='#' class='searchedCities" + myStoredCities[i] + ">" + myStoredCities[i] + "</a>");
// }

// loadStoredCities();

// document.addEventListener('click', event => {
//     if(event.target.classList.contains('storedCity')){
//         let cityName = event.target.dataset.city
//         console.log(cityName)
// }
// })

document.getElementById('searchBtn').addEventListener("click", event=> {
    let cityName = document.getElementById('cityName').value 

    let storedCities = JSON.parse(localStorage.getItem('storedCities')) || []

    storedCities.push(cityName)

    localStorage.setItem('storedCities', JSON.stringify(storedCities))

    console.log(cityName)
    axios.get(`https://api.openweathermap.org/data/2.5/forecast?q=${cityName}&units=imperial&appid=f33a26ed559de7a11743569e84a3db0e`)

    .then(res=> {
        console.log(res.data)
        let lat = res.data.city.coord.lat 
        let lon = res.data.city.coord.lon
        
        axios.get(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&appid=f33a26ed559de7a11743569e84a3db0e`)
        .then(resp=> {
            console.log(resp.data)
            let uvi 
            if (resp.data.current.uvi <2) {
                uvi = 'green'
            }
            else if (resp.data.current.uvi < 5) {
                uvi = 'yellow'
            }
            else {
                uvi= 'red'
            }
        document.getElementById('currentDiv').innerHTML = `
        <div class="row">
            <div class="col s12 m7">
             <div class="card">
                 <div class="card-image">
                <img src="http://openweathermap.org/img/wn/${res.data.list[0].weather[0].icon}@4x.png">
                <span class="card-title black-text">${res.data.city.name}</span>
                </div>
                <div class="card-content">
                 <p>${res.data.list[0].dt_txt}</p>
                 <p>temperature: ${res.data.list[0].main.temp} °F</p>
                 <p>humidity: ${res.data.list[0].main.humidity} %</p>
                 <p>wind speed: ${res.data.list[0].wind.speed} mph </p>
                 <p class="${uvi}">humidity: ${resp.data.current.uvi}</p>
             </div>
             <div class="card-action">
            </div>
        </div>
        </div>
    </div>
        `
        let weatherArray = []
        let day1 = {
            date: res.data.list[8].dt_txt, 
            icon: res.data.list[8].weather[0].icon,
            temperature: res.data.list[8].main.temp, 
            humidity: res.data.list[8].main.humidity
        }
        let day2 = {
            date: res.data.list[16].dt_txt, 
            icon: res.data.list[16].weather[0].icon,
            temperature: res.data.list[16].main.temp, 
            humidity: res.data.list[16].main.humidity
        }
        let day3 = {
            date: res.data.list[24].dt_txt, 
            icon: res.data.list[24].weather[0].icon,
            temperature: res.data.list[24].main.temp, 
            humidity: res.data.list[24].main.humidity
        }
        let day4 = {
            date: res.data.list[32].dt_txt, 
            icon: res.data.list[32].weather[0].icon,
            temperature: res.data.list[32].main.temp, 
            humidity: res.data.list[32].main.humidity
        }
        let day5 = {
            date: res.data.list[39].dt_txt, 
            icon: res.data.list[39].weather[0].icon,
            temperature: res.data.list[39].main.temp, 
            humidity: res.data.list[39].main.humidity
        }
        weatherArray.push(day1, day2, day3, day4, day5)
        console.log(weatherArray)

        weatherArray.forEach(day=> {
            document.getElementById('fiveDay').innerHTML += `
            <div class="row">
                 <div class="col s12 m7">
                <div class="card">
                <div class="card-image">
                 <img src="http://openweathermap.org/img/wn/${day.icon}@4x.png">
                     <span class="card-title black-text">${day.date}</span>
                </div>
                 <div class="card-content">
            <p>${day.temperature} °F</p>
            <p>${day.humidity} %</p>
            </div>
                <div class="card-action">
                </div>
            </div>
        </div>
    </div>
         `
        })
        })

    })
})





    </script>
</body>
</html>
            